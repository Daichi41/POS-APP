# フェーズ1 要件定義

## 目的
- ポップアップストア向け簡易POSのMVP範囲・機能要件・成功指標を確定する
- 現場運用（担当者・店舗環境）と技術制約（端末・ネットワーク・既存システム）を整理する

## プロジェクト概要
- 想定ストア：2週間限定のポップアップ（1ブース・スタッフ3名/シフト）
- 取扱商品：SKU 150点、単価500〜25,000円、軽減税率対象なし
- 既存資産：商品マスタCSV、社内会計システム連携用S3バケット、Squareリーダー（参考運用）
- 運用端末：iPad第9世代（iOS17）、Androidハンディ端末（Android13）を各2台

## ステークホルダー
- 事業責任者（プロダクトオーナー）：売上・回転率を最重視し、日次レポートで指標確認
- 店舗リーダー：スタッフ稼働と端末トラブル一次対応を担当
- 店舗スタッフ：会計処理を担当、ITリテラシーは中程度（研修1時間）
- 情報システム部：バックエンド運用・セキュリティ基準を監督

## MVP機能要件
- 会計フロー
  - バーコードスキャン、手入力検索による商品追加
  - 数量変更、割引（パーセント/定額）適用、行削除、取消と再スキャン
  - 税込・税抜価格表示、合計額計算、会計確定処理
  - レシートメール送信（任意入力メールアドレス宛）
- 商品/在庫
  - 商品マスタ同期（CSVインポートを1日1回手動実行）
  - 在庫数表示（読み取り専用、会計処理で自動更新）
- 決済
  - 現金・カード（金額入力・ステータス記録のみ、決済端末は外部）
- 監査/管理
  - 当日取引一覧、検索/フィルタ、取引取消（マネージャーPIN承認）
  - 日次売上サマリをCSVでエクスポート（S3へアップロード）

## 非機能要件
- パフォーマンス：会計開始〜確定まで平均60秒以内、ピーク時（同時端末4台）でもAPI応答1秒未満
- 可用性：営業時間（10:00〜20:00）でSLA99%、通信断時はオフラインモードで最大50取引をローカルキュー
- セキュリティ：スタッフは共有端末にPINログイン、伝送はTLS1.2以上、個人情報は24時間でマスク
- ログ：会計履歴・操作ログをCloudWatchへ15分以内に送信、保持期間1年
- アクセシビリティ：タッチターゲット44px以上、日本語/英語表示切替、音声読み上げ対応

## 業務フロー（ハッピーパス）
1. スタッフがPINログイン
2. 商品バーコードをスキャンしカートに追加
3. 必要に応じ数量・割引を調整
4. 決済種別を選択し確定
5. レシートメールを入力（任意）して送信、完了画面で次取引へ遷移

## エッジケースと例外処理
- バーコード未登録：手入力検索→マネージャー承認で暫定SKU登録、後続で本登録
- カメラアクセス拒否：端末設定確認ダイアログ表示、手入力モードへ切替
- 通信断：ローカルIndexedDBにキュー保存→復旧時に自動同期し成功/失敗通知
- 決済失敗：スタッフが再試行または現金決済へ切替、ログに失敗理由記録
- 在庫不足：警告表示とマネージャー承認で販売続行可

## 成功指標（KPI/KGI）
- KGI：イベント期間売上目標900万円、欠品ロス率3%以下
- KPI：
  - 平均会計処理時間 80秒→60秒以内
  - 会計中断率 5%以下
  - 取引取消承認応答時間 10分以内
  - オフライン同期成功率 98%以上

## 運用条件
- シフト：開店前30分で端末点検、閉店後30分で日次締め
- サポート：一次対応は店舗リーダー、二次対応は情シス（10:00〜22:00オンコール）
- 端末メンテ：OSアップデートはイベント前週に完了、MDMでアプリを配布
- バックアップ：取引データはAWS RDS自動バックアップ＋日次ポイントインタイム

## リスクと対策
- ネットワーク断続 → LTEルーター冗長化、オフライン設計徹底
- 商品マスタ差異 → CSV取込時の差分検証、エラー通知メール
- スタッフ操作ミス → UIガイドとトレーニング、権限条件と確認ダイアログ
- セキュリティインシデント → 端末リモートワイプ、認証ログ監視

## 成果物
- 要件定義書（本ドキュメントを最新版管理、Gitでバージョン管理）
- ユーザーストーリーと受け入れ条件（下記参照）
- リスク登録簿と対策方針

### ユーザーストーリー例
- スタッフとして、バーコードを素早く読み取りたい。読み取りに失敗した場合はすぐ再スキャンできること。
- マネージャーとして、取消処理を遠隔承認でき、監査ログが残ること。
- 情シス担当として、日次でS3に売上データがアップロードされることを確認したい。

### 受け入れ条件サンプル
- 10件を30秒以内でカートに追加できる（テストID AC-01）
- 通信断状態で取引を行い、復旧後に自動同期される（AC-07）
- 取消操作はマネージャーPINが正しくないと失敗する（AC-12）

## インプット
- reference/スクリーンショット (2401).png : Lv2画面イメージ
- reference/スクリーンショット (2402).png : Lv2 API機能定義
- reference/スクリーンショット (2403).png : Lv2 DBイメージ
- reference/スクリーンショット (2404).png : シナリオストーリー

## 移行条件
- 全主要ステークホルダーの承認（PO・店舗責任者・情シス）を取得済み
- 非機能要件（性能・セキュリティ・可用性・監査）の合意と優先度評価が完了
- UI/UX・API・DB設計タスクが着手可能な粒度まで要件が確定
